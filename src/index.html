<!DOCTYPE HTML>
<html>
  
  <head>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
<link href="https://fonts.googleapis.com/css?family=Noto+Sans" rel="stylesheet">

  </head>
  
  
  <div class="jumbotron" id="header">
   <h1>fastheatmap</h1> 
    </div>
  
  <div class="container">
  <div class="jumbotron">
    
 <h6> 
  <p>Step 1: Upload your heatmap file as csv, make sure its first column is the name of the subsquent rows </p>
  <p><a href="300k_by_8.csv" target="_blank">(Click to View Sample Gene File Download)</a></p>
  <p>Step 2: Choose your high and low colors</p>
  <p>Step 3: The heatmap is made automatically, you can zoom in, zoom out, and other functions provided in the heatmap palette</p>
 </h6>

  </div>
</div>
  
  <div class="container">

<br>
<br>

</div>

<i class="fa fa-pencil-square-o" aria-hidden="true"></i>


<style>
#header{
  background-color: #082c66;
  color:white;
}

body {
	font-family: 'Noto Sans', sans-serif;
	background-color:#fcffff;
}

a{
  color:white;
}

a:hover{
  color:grey;
}

.jumbotron {
     background-color: #a7b8bc;
  	font-family: 'Noto Sans', sans-serif;
   color:white;

}


 #header {
   	font-family: 'Noto Sans', sans-serif;
  	background-image:url(http://blog.creative-tim.com/wp-content/uploads/2015/06/header.jpg) ;

}


pre{
display:none;
}

.error {color: #FF0000;}
h1 {
    color: black;
}

 .btn-sq-lg{
 width: 170px !important;
  height: 170px !important;
  background-color:#2d8591;
  color: white;
   box-shadow: 3px 3px 3px #888888;
    font-size: 16px;
   
}

 .btn-sq-lg:hover{
  color:white; 
  background-color: #a7b8bc;
   font-size: 18px;
 
 }

.btn-primary{
  background-color:#2d8591;
  border:none;
  box-shadow: 3px 3px 3px #888888;

}

.btn-primary:hover{
  color:white; 
  background-color:#a7b8bc;
  border:none;

}

.button {
  
    padding: 15px 32px;
    text-align: center;
    display: inline-block;
    font-size: 25px;
    margin: 4px 2px;
    cursor: pointer;
}




</style>

<head>

<div class="container">

  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
        <link rel="stylesheet" href="css/colorpicker.css" type="text/css" />
    <link rel="stylesheet" media="screen" type="text/css" href="css/layout.css" />
        <script type="text/javascript" src="js/jquery.js"></script>
        <script type="text/javascript" src="js/colorpicker.js"></script>
    <script type="text/javascript" src="js/eye.js"></script>
    <script type="text/javascript" src="js/utils.js"></script>
    <script type="text/javascript" src="js/layout.js?ver=1.0.2"></script>
        <!-- Numeric.js -->
 <script src="    https://cdnjs.cloudflare.com/ajax/libs/numeric/1.2.6/numeric.min.js"></script> 
<!-- Plotly.js -->
        <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
        <!--<script src="plotly/loader/loadersrc/plotly-latest.min.js"></script>-->
        <!--<script src='libs/numeric.min.js'></script>=--> 
        </head>
        <body>
	  <script src="plotly-latest.min.js"></script>

<script src="d3.min.js?v=3.2.8"></script>
<script src="https://d3js.org/d3.v4.min.js"></script>
<script src="jquery-csv.js"></script>


  <div id="wrap">
	
	<br>
 
 <br>

  </div>
  
  
  
<div class="container">
  
  <div class="row" > <h1>Step 1: Upload Your Gene File</h1></div>
  
  <br>
 
  
  <div class="row" >
    <div class="col-lg-4">
      <form action="javascript:void(0);" id="the_form">
	  <input type="file" id="the_file" required="required" accept=".csv" />
	  </div>
	  <div class="col-lg-4">
	  <input type="submit" value="Press to name Columns" class="btn btn-primary btn-md" />
	</form>
	<div id="file_info"></div>
	<div id="list"></div>
	</div>
   
    </div>
   
    
  </div>
</div>


        <h3> <p id="demo"></p></h3>

	
<br>
<br>

        <script src="jscolor.js"></script>

<div class="container">
  
   <h1>Step 2: Choose Your Heatmap Colors</h1>
  
  <div class="row" > <br> </div>
  
  <div class="row" id="color1">
    <div class="col-lg-4">
      
     
       <h4><button
       class="jscolor {valueElement:'chosen-value', onFineChange:'setTextColorTwo(this)'} btn btn-sq-lg">
     Low Color </button></h4>
       
    </div>
    <div class="col-lg-4" id="color2">
      
       
      <h4> <button class="jscolor {valueElement:'chosen-value', onFineChange:'setTextColor(this)'} btn btn-sq-lg">
      High Color
      </button></h4>
      <input type="hidden"  id="chosen-value" value="000000">
      
    </div>
    
  </div>
</div>

<br>
  <br>

      <div class="container">
   <h1>Step 3: Create Your Heatmap</h1>
      </div>

  <br>
  <br>
  <br>


	 <script>
        function setTextColor(picker) {
  document.getElementsByTagName('h5')[0].style.color = '#' + picker.toString();
}
     </script>

        
	<script>
        function setTextColorTwo(picker) {
  document.getElementsByTagName('h2')[0].style.color = '#' + picker.toString();

        }
        </script>

        

<script>
function setColors(){

    var x = document.createElement("INPUT");
    x.setAttribute("type", "color");
    document.body.appendChild(x);


}
</script>
        <!-- Plotly chart will be drawn inside this DIV -->



<div id="myDiv"></div>


<!--<button onclick="setColors()">Click me</button>-->
<script src="https://d3js.org/d3.v4.min.js"></script>

<script type="text/javascript">

	function fileInfo(e){
		var file = e.target.files[0];
		if (file.name.split(".")[1].toUpperCase() != "CSV") {
			alert('Invalid csv file !');
			e.target.parentNode.reset();
			return;
		}
	}

	function handleFileSelects(){
		var file = document.getElementById("the_file").files[0],
			reader = new FileReader();

	reader.onload = function(file) {
		var content = file.target.result,
			rows = file.target.result.split(/[\r\n|\n]+/),
			i = 0,
			labels = [],
			data = [],
			nameDataLog=[],
			tempData,
			nameData;
		for (; i < rows.length; i++){
			tempData = rows[i].split(',');
			nameData= tempData[0];
							nameDataLog.push(nameData);

			if (i === 0) {
				labels = tempData;
			}

			//If you dont' want labels in the dataset then put this in the else statement
			else{
			data.push(tempData);
			}
		}

// You'll see here you have access to the full data set of data and also one called labels. Labels. I put in console logs
nameDataLog=nameDataLog.slice(1,nameDataLog.length);
localStorage.setItem("quentinTarantino", JSON.stringify(labels));
localStorage.setItem("logTime", JSON.stringify(nameDataLog));
	};

	reader.readAsText(file);
 }

 document.getElementById('the_form').addEventListener('submit', handleFileSelects, false);
 document.getElementById('the_file').addEventListener('change', fileInfo, false);

</script>


<script>

function makeplot() {
  //Plotly.d3.csv("localhost", function(data){ processData(data) } );

};



var wait = true; 
var zValues = [];

function popData(fl) { 
Plotly.d3.csv(fl, function(data) {
console.time('someFunction');

var retrievedData = localStorage.getItem("quentinTarantino");
var labels = JSON.parse(retrievedData);

var array=[]
for(var i = 1; i < labels.length; i++ ) {
      array.push(labels[i])
  
}

function t(fields) {
  return function (data) {
    return fields.map(function (field) {
      return +data[field]
    })
  }
}
 <!-- dataset = data.map(function(d) { return [ +d["Control 1"], +d["Control 2"], +d["Exp3"], +d["Exp4"], +d["Exp5"], +d["Exp6"] ]; });-->
 dataset = data.map(t(array));
     

    

 zValues = dataset; 
  console.log(zValues); 

console.timeEnd('someFunction');

  wait = false; 
}); 

}; 

  function handleFileSelect() {
    var file   = document.getElementById("files").files[0];
    var reader  = new FileReader();


  reader.addEventListener("load", function () {
    var fileURI = reader.result;
    popData(fileURI);
    console.log("fired");
    console.log(fileURI);




  }, false);

  if (file) {
    reader.readAsDataURL(file);



  }
}     
  
//popData(); 

function processData(allRows) {



  zValues = allRows; 
  var x = [], y = [], standard_deviation = [];

  for (var i=0; i<allRows.length; i++) {
    row = allRows[i]; 
  }
  console.log( 'X',x, 'Y',y, 'SD',standard_deviation );
  makePlotly( x, y, standard_deviation );
}
makeplot(); 
//popData(); 

function setColor(){
				  
    var x = document.createElement("INPUT");
    x.setAttribute("type", "color");
    document.body.appendChild(x);
    

}
function getResult(){


				  
      if (!wait) {
        var retrievedData = localStorage.getItem("quentinTarantino");
var labels = JSON.parse(retrievedData);

var retrievedDatas = localStorage.getItem("logTime");
var nameData = JSON.parse(retrievedDatas);

localStorage.removeItem("logTime");
localStorage.removeItem("quentinTarantino");
labels=labels.slice(1,labels.length);
                   var xValues = labels;<!-- [' Team A', ' Team B',' Team C',' Team D',' Team E'];-->

var yValues = nameData; <!-- ['Team W', 'Team X', 'Team Y', 'Team Z'];-->
console.log(xValues);
console.log(yValues);
//console.log(zValues);

var age= document.getElementsByTagName('h5')[0].style.color;
var rude = document.getElementsByTagName('h2')[0].style.color;
var colorscaleValue = [
 
				  
  [0,age],
  [1,rude]
];

var data = [{
  x: xValues,
  y: yValues,
  z: zValues,
  type: 'heatmap',
  colorscale: colorscaleValue,
  showscale: false
}];

var layout = {
  title: 'High Performance Interactive Heatmap',
  annotations: [],
  xaxis: {
    ticks: '',
    side: 'top'
  },
  yaxis: {
    ticks: '',
    ticksuffix: ' ',
    width: 700,
    height: 700,
    autosize: false
  }
};

for ( var i = 0; i < yValues.length-1; i++ ) {
  for ( var j = 0; j <xValues.length; j++ ) {
      
    var currentValue = zValues[i][j];
    if (currentValue != 0.0) {
      var textColor = 'white';
    }else{
      var textColor = 'black';
    }
    var result = {
      xref: 'x1',
      yref: 'y1',
      x: xValues[j],
      y: yValues[i],
      text: "",
     <!-- text: zValues[i][j],-->
      font: {
        family: 'Arial',
        size: 12,
        color: 'rgb(50, 171, 96)'
      },
      showarrow: false,
      font: {
        color: textColor
      }
    };
    layout.annotations.push(result);
  }
}

Plotly.newPlot('myDiv', data, layout);
      } else {
           setTimeout(getResult, 250);
      }
 }

getResult(); 
        </script>



    </body>
    
    
<div class="container">
<input type="file" id="files" name="files[]" onchange="handleFileSelect()" />

<output id="list"></output>

</div>

        </body>
        </div>
</html>
